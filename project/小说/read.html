<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
        <div class="container">
   
              </div>
<div onclick=" last()">
  下一章
</div>
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>
      var names=null
      var obs=null
     var nub=null
     var number=null
     var bosx=[]
      function getData(){
	       if(document.URL.indexOf("?")<0) return;//获取当前url地址,如果没参数.直接返回
	       var str=document.URL.split("?")[1];
         console.log(str);
         nub=str
	       var obj={};
	       var arr;
        
	       //当只有一个参数传过来时
	      //  if(str.indexOf("&")<0){
	      //      if(str.indexOf("?")<0) return;
	      //      arr=str.split("11");
	      //      obj[arr[0]]=arr[1];
        //      obs=obj[""]
        //      console.log(obs);
        //      nub=obs
        //      var xxs=window.localStorage.string
        //      console.log(xxs);
        //      names=JSON.parse(xxs)
	      //      return obj;
	      //  }

	   }
     $(document).ready(function(){
//  console.log(JSON.parse(localStorage.string).data.chapterList[nub].chapterId);
 var xhr =  new XMLHttpRequest();
xhr.onreadystatechange = function () {
 if(xhr.readyState == 4){
     if(xhr.status >= 200 && xhr.status < 304 || xhr.status == 304){
         console.log(xhr.responseText);  
         xxb=  xhr.responseText
         var as=JSON.parse(this.response)     
      xxx(JSON.parse(xxb).data)
     }
 }
}
var ull=JSON.parse(localStorage.string).data.chapterList[nub].chapterId
console.log(ull);
xhr.open('get', 'https://api.pingcc.cn/fictionContent/search/'+JSON.parse(localStorage.string).data.chapterList[nub].chapterId+'');
xhr.send(null);
});
	console.log(getData());
function booKname() {
  $('.smbox').last().append('<h3>'+JSON.parse(localStorage.string).data.chapterList[nub].title+'</h3>')
}
     function xxx(arr) {
      
      $('.container').append('<div class="smbox"></div>');
      booKname()
            $.each(arr, function (i, e) {
                  $('.container').children().last().append('<p>'+arr[i]+'</p>');         
            });
        }


function last() {

  nub++
  console.log(nub);
        var xhr =  new XMLHttpRequest();
xhr.onreadystatechange = function () {
 if(xhr.readyState == 4){
     if(xhr.status >= 200 && xhr.status < 304 || xhr.status == 304){
         console.log(xhr.responseText);  
         xxb=  xhr.responseText
         var as=JSON.parse(this.response)
      //  localStorage.string=xxb
      xxx(JSON.parse(xxb).data)
     }
 }
}
// var ull=names.data.chapterList[obs].chapterId
xhr.open('get', 'https://api.pingcc.cn/fictionContent/search/'+JSON.parse(localStorage.string).data.chapterList[nub].chapterId+'');
xhr.send(null);

}
console.log(getData());



/**
* 获取滚动条位置
*/
function getScrollTop() {
   var scrollPos;
   if (window.pageYOffset)
   {
       scrollPos = window.pageYOffset;
   }
   else if (document.compatMode && document.compatMode != 'BackCompat')
   {
       scrollPos = document.documentElement.scrollTop;
   }
   else if (document.body)
   {
       scrollPos = document.body.scrollTop;
   }
   return scrollPos;
}

/**
 * 防抖函数
 * @param method 事件触发的操作
 * @param delay 多少毫秒内连续触发事件，不会执行
 * @returns {Function}
 */
 function debounce(method,delay) {
    let timer = null;
    return function () {
        let self = this,
            args = arguments;
        timer && clearTimeout(timer);
        timer = setTimeout(function () {
            method.apply(self,args);
        },delay);
    }
}
window.onscroll = debounce(function () {
  let scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
  var winHeight = $(window).height()
  var docHeight = $(document).height()
  if (scrollTop + winHeight == docHeight) {
    console.log('滚动条位置：' + scrollTop,winHeight,docHeight);
    last()
    var NumberBook=$(".smbox")
    console.log(NumberBook);
    console.log(NumberBook==[]);
if (NumberBook.length>2) {
  $(".container").children().first().remove()
  console.log(NumberBook);
}
    }


},500)


    </script>
  </body>
</html>